# 第六章 - 防火墙基础

## 下一代的网络安全设备应该具有以下几种控制手段
* 阻塞、允许
阻塞和允许是传统安全设备的基本策略，而**基于应用的黑白名单**可以让IT管理者将企业需要的应用**有条件地放开**，将与企业无关的高风险应用进行彻底阻塞(如P2P、炒股、网络视频)。但除了阻塞以外，**更重要的是如何安全地使用应用**。

* 多种条件的限制
新的安全架构需要**基于各种条件对应用的使用做限制**，如基于用户、用户群组、vlan、终端类型、时间段以及应用的细化功能等条件。
* 安全扫描
通过对应用进行入侵扫描、病毒扫描和URL过滤来发现应用中所携带的风险
* 威胁的主动防御
由于威胁不断变化、善于隐藏，部分威胁可能会逃脱安全扫描，这时就需要有**不基于特征识别技术的主动防御功能来发现未知的威胁**。主动防御技术通过**对用户的应用行为分析、安全基线对比分析、集成关联分析来发现潜在的僵尸主机和攻击行为**，保障企业网的应用安全
* 流量整形
**基于应用的流量整形**通过**流量保障和流量控制技术**来防止无关应用对企业关键应用的干扰，提升带宽的价值

## 防火墙概论
#### 防火墙定义

##### 防火墙由来
防火墙是指设置在**不同网络（如可信任的内部网和不可信的公共网）或网络安全域**之间的一系列部件的组合。

它是不同网络或网络安全域之间信息的**唯一出入口**，能根据安全策略控制（允许、拒绝、监测）出入网络的信息流。

本身具有较强的**抗攻击能力**。

##### 防火墙作用
防止**不希望的、未授权**的信息进出被保护的网络

在逻辑上，防火墙为**分离器、限制器、分析器**

##### 防火墙三大要素
* 安全
* 管理
* 速度

#### 防火墙优点
* 防火墙是网络安全的屏障
 一个防火墙（作为**阻塞点、控制点**）能极大地提高一内部网络的安全性，并通过过滤不安全的服务而降低风险。

* 控制对主机系统的访问

* 监控和审计网络访问
 如果所有的访问都经过防火墙，那么，防火墙就能**记录**下这些访问并作出**日志记录**，同时也能提供**网络使用情况的统计数据**

* 防止内部信息的外泄
 利用防火墙对内部网络的划分，可实现**内部网重点网段的隔离**，从而限制了局部重点或敏感网络安全问题对全局网络造成的影响。

* 部署网络地址翻译(NAT)机制
可以缓解地址空间短缺问题，隐藏内部网络结构。

#### 防火墙缺点
* 防火墙不能防范来自**内部网络**的攻击

* 防火墙不能防范**不经过防火墙**的攻击

* 防火墙不能防范**感染病毒的软件或文件的传输**

* 防火墙不能防范**数据驱动式**攻击
当有些表面看来无害的数据邮寄或复制到内部网的主机上并被执行时，可能会发生数据驱动式的攻击。

* 防火墙不能防范利用**标准网络协议中的缺陷**进行的攻击
一旦防火墙**准许某些标准网络协议**，就不能防止利用该协议中的缺陷进行的攻击。

* 防火墙不能防范利用**服务器漏**洞进行的攻击
防火墙不能防止黑客通过**防火墙准许的访问端口**对该服务器的漏洞进行攻击。
* 防火墙不能防范**新的网络安全问题**
防火墙是一种**被动式**的防护手段，它只能对现在**已知的网络威胁**起作用

* 防火墙可能**限制有用的网络服务**


## 防火墙的基本结构
* 屏蔽路由器
    * 屏蔽路由器是防火墙**最基本的构件**。
    * 屏蔽路由器作为**内外连接的惟一通道**，要求所有的报文都必须在此通过检查。

* 双重宿主主机防火墙
    * 这种配置是用一台装有**两块网卡的堡垒主机做防火墙**。
    * 两块网卡分别与**内部网和外部网相连**。
    * 堡垒主机上运行着防火墙软件。
    * 内部网和外部网之间的**直接通信被完全阻止**
    * 致命弱点：一旦入侵者侵入**堡垒主机并使其只具有路由功能**，则网上任何用户均可以自由访问内网

* 屏蔽主机防火墙
    * 一个分组过滤路由器**连接外部网络，并在其上设立过滤规则**
    * 一个堡垒主机安装在内部网络上，成为从外部网络**惟一可直接到达的主机**
    * 确保内部网络不受未被授权的外部用户的攻击

* 屏蔽子网防火墙
    * 在内部网络和外部网络之间建立一个**被隔离的子网（周边网络）**，用**两台分组过滤路由器**将这一子网分别与内部网络和外部网络分开
    * 危险区域包括**堡垒主机**、**子网主机**及所有连接内网、外网和屏蔽子网的**路由器**
    
* 其他防火墙结构
    * 一个堡垒主机，一个非军事区
    * 两个堡垒主机，两个非军事区
    * 两个堡垒主机，一个非军事区

**DMZ非军事化区**：为了解决安装防火墙后外部网络不能访问内部网络服务器的问题，而设立的一个**非安全系统与安全系统之间的缓冲区**，外部INTERNET以及内部INTRANET可以自由的访问该区。 

## 防火墙的模型与分类

#### 防火墙的模型

#### 防火墙的分类

* 包过滤防火墙
    根据所建立的一套**规则**，检查每一个**通过的网络**包，或者丢弃，或者放行，这称为包过滤防火墙。目的是**放行正常的数据包，截住有危害的数据包**。

* 状态/动态检测防火墙
    一个有状态包检查防火墙跟踪的不仅是包中包含的信息。为了跟踪包的状态，防火墙还**记录有用的信息以帮助识别包**，例如已有的网络连接、数据的传出请求等。

    e.g. 对于传入的TCP包，只有它是在响应一个已建立的连接时，才会被允许通过。
    
* 应用程序代理防火墙
    应用程序代理防火墙实际上并**不允许它连接的网络之间直接通信**。相反，它接受来自**内部网络特定用户应用程序的通信**，然后建立与公共网络服务器**单独的连接**。

* 个人应用防火墙
                

## 攻击方式与防火墙防御

* 攻击步骤：踩点 → 扫描 → 攻击

#### 网络攻击的基本手段
###### 非法权限类
* 特洛伊木马
一种未经授权的程序，或在合法程序中有一段未经授权的程序代码，或在合法程序中包含有一段用户不了解的程序功能。上述程序**对用户来说具有恶意的行为**。
    * 陷阱入口类
    * 功能欺骗类
    * 信息窃取类(eg.攻击口令）
    * 逻辑炸弹类
        * 逻辑炸弹是程序中的一部分，**满足一定条件时**激活某种特定的程序，并产生系统自毁，并附带破坏
        * 防御： 软件黑盒技术


###### 传染类 -- 计算机病毒
* 源码类
与**CPU指令系统无关的病毒程序**，不通过改造被传染的源程序来获取控制权，而是利用一些应用程序所留出的入口来进入系统，典型的方式是**宏命令**

* 目标码类
    * 感染期 → 操作期 → 发作期
    * 截获控制权 → 操作 → 动作

* 侵占资源类
    * 举例：
        * icmp_flood，用假冒的源地址向目的主机不断发送ICMPecho请求包，占用网络带宽及主机的CPU时间。
        * syn_flood SYN连接请求洪泛。用伪造的源地址向目的主机不断发出各种连接请求，占用网络带宽和目的主机CPU资源；从而使得其他主机远程登录非常慢。
        * mailbomb 邮件炸弹，通过假帐号不断向目的邮件服务器发送mail, 从而影响服务器的性能。
    * 一对一式攻击
    * 兑变式攻击：一种典型的蠕虫式模式，其通过某种手段使得网上用户为攻击者派生新的攻击源并适时发出去


###### 蠕虫类（非法侵占)

###### 网络攻击概览
* 五大类型攻击
    * 口令攻击
    * 拒绝服务攻击（也叫业务否决攻击）
    * 利用型攻击
    * 信息收集型攻击
    * 假消息攻击

* 攻击防火墙的主要手段
    * 前缀扫描攻击
    * 数据驱动攻击
    * 报文攻击
    * 电污染攻击
    * 社会工程攻击
    * IP地址欺骗
    * TCP序列号攻击
    * 基于附加信息的攻击
    * 基于堡垒主机web服务器的攻击
    * IP隧道攻击
    * 计算机病毒攻击
    * 特洛伊木马攻击

## 防火墙的发展
#### 第一代防火墙
* 包过滤路由器或屏蔽路由器

* 第一代防火墙只有分组过滤的功能，且与路由器是一体的。这种防火墙很难抵御地址欺骗等攻击，审计功能差

#### 第二代防火墙
* 代理服务器，可提供**应用服务级的控制**，起到外部网络向被保护的内部网申请服务时**中间转接作用**。
	
* 对于每一种网络应用服务都必须为其设计一个**代理软件模块**来进行安全控制。

* 每一种网络应用服务的安全问题各不相同，分析困难，因此实现也困难，同时代理的时间延迟一般比较大

#### 第三代防火墙
建立在通用操作系统上的商用防火墙产品

---
有些地方整理不完全，复习仍需要看原ppt

2017.10.04
    

