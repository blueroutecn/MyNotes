# 第五章 - 负载均衡算法

负载均衡：流量导向

关键：怎样保障业务连续性

---
* 链路负载均衡：
    * 健康检查：是否同？服务质量如何？服务能力如何？
    * 链路选择：带宽或就近性算法
* 本地负载均衡：
    * 健康检查
    * 流量重定向
* 全局：
    * 流量重定向
    * 就近性

* 应用背景：访问量增长，业务量增长
```
服务器busy，链路busy
ping不通：可能是链路有问题
```

## 负载均衡
#### 负载均衡原理：
* 调度：根据分配算法，将流量导向到不同节点
* 健康性评估

#### 负载均衡策略

**在什么地方提供负载均衡服务**

**基于DNS(入口）/反向代理/特定服务器软件/NAT/CDN**

* 基于DNS:
一个域名绑定多个ip，通过DNS服务中随机域名解析实现

* 基于反向代理：
    * 优点：自带高速缓冲，减轻压力
    * 缺点：并发连接请求数量大时，代理服务器会成为服务瓶颈
    
* 基于特定服务软件
* 基于NAT：一个外部地址 → 多个内部地址
* CDN:将网站内容发布到最接近用户的网络“边缘”
    * CDN存储：
    1. 源
    2. 数据一致性
    3. 即时性、有效性
    4. 存什么（安全性、内容）
    优点：用户就近访问服务器，提高访问速度

## 负载均衡算法
* 1. 轮询
注意，当某一服务器故障时，则不参与下一次的轮询
* 2. 比率
给每个服务器分配一个加权值为比例
* 3. 优先权
给服务器分组，分配到不同的组，组内可再采用轮询算法
* 4. 最小连接
将连接传递给当前连接最少的服务器
* 5. 最快模式
选择相应最快的服务器，注意，响应快≠服务快
* 6. 观察
以连接数目和相应时间的最佳平衡为依据
* 7. 预测模式
* 8. 动态分配
收集参数、指标，动态分配
* 9. 动态补充
* 10. 服务质量
* 11. 服务类型
* 12. 规则模式
    



