#　Ping命令解析
---
## ICMP简介
* 由于ip协议缺少差错控制和辅助机制

* ICMP使用ip协议进行信息传递控制信息，控制信息包括：网络是否畅通、主机是否可达、路由是否可用等网络本身的消息

* ICMP报文有两种类型：
    差错报文：由路由器或目的主机产生；
    查询报文：主要用于帮助用用户从另一个主机或路由器获得特定的信息


## Ping

#### 基本含义

ping (Packet Internet Groper)，**因特网包探索器**，用于测试网络连接量的程序。Ping发送一个**ICMP**；回声请求消息给目的地并报告是否收到所希望的ICMP echo （ICMP回声应答）。它是用来**检查网络是否通畅或者网络连接速度的命令**。

#### 协议
ICMP协议

#### 原理
向指定的网络地址发送**一定长度的数据包**，按照约定，若指定网络地址存在的话，会**返回同样大小的数据包**，当然，若在**特定时间**内没有返回，就是“超时”，会被认为指定的网络地址不存在。

####　参数说明

* -t: 不停的ping指定的计算机，直到按下Ctrl+C中断
* -l length：发送指定数据量的ECHO数据包。默认为 32 字节；最大值是65500字节；
* -n count：发送count指定的ECHO数据包数。通过这个命令可以自己定义发送的个数，**对衡量网络速度很有帮助**。能够测试发送数据包的返回平均时间，及时间的快慢程度。默认值为 4。 

####　补充说明
* PING命令的数据包，只携带**出发地和目的地的ip地址**，以及一个简单的**计时器**和**计数器**，并都设置**从0开始计时和计数**。

* 到目的地后，这个ip包被“调包”，将包头中的源、目的ip调换；

* 数据包来回的路由未必一致；

* ping 本机ip地址：检查本机的ip地址是否设置有误；

* ping 127.0.0.1: 127.0.0.1是回送地址，ping回送地址是为了查看本机的TCP/IP是否有设置好，若不通，则说明没有设置好；

* 返回信息 request timed out: 所经过的路由器的路由表中具有到达目标的路由，而目标由于其他原因而不可达。


```
原因：

	1. ip 地址设置错误；
	
	2. 对方已关机，或网络上根本没有这个地址；
	
	3. 对方设置了ICMP过滤；

	4. 对方与自己不在同一网段，通过路由也无法找到；

```

* 返回信息 destination host unreachable: 路由表中无到达目标路由；

```
原因：

	1. 网线没有插在网卡上;
	
	2. 子网掩码设置错误；
	
	3. DHCP故障（客户机无法分配到ip）;
	
	4. 路由表返回错误信息（说明本地计算机与外部网络连接没有问题，但与某台主机连接存在问题）

```

---
以上内容参考自：《一本书读懂TCP/IP》 8.2节内容；


2017.09.30
